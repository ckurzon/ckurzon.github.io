<title>World Snow Depth</title>
<style>

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: .5px;
  stroke-opacity: .5;
}

.land {
  fill: #222;
}

.county-boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

.state-boundary {
  fill: none;
  stroke: #fff;
}

</style>
<body>
Time: 2005 <input type="range" name="points" min="2005" max="2015" step="1" value="0" id="slider-time" oninput="year_value();"> 2015
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
  <form>
    <label><input type="radio" name="layout" value="by_state"> Snowfall by State </label> 
    <label><input type="radio" name="layout" value="by_state"> SnowDepth by State </label>
  </form>
<script>

var downloaded_data;

var states = [];

var county_state_list = [];
var aggregate_list = [];
var listed = false;

var width = 960,
    height = 500;

var projection = d3.geo.albers()
    .rotate([96, 0])
    .center([-.6, 38.7])
    .parallels([29.5, 45.5])
    .scale(1070)
    .translate([width / 2, height / 2])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);

var graticule = d3.geo.graticule()
    .extent([[-98 - 45, 38 - 45], [-98 + 45, 38 + 45]])
    .step([5, 5]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

function year_value(data) {
    d3.selectAll("input").each(function(d) {
        if(d3.select(this).attr("type") == "range") {
            year = (this).value;
        }
    })
    by_year(year);
};

svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

d3.tsv("data/sndpth.tsv", function(error, data) {
  data.forEach(function(d) {
      for (j = 0; j < county_state_list.length; j++) {
        if (county_state_list[j] == d.county + " " + d.state) {
          listed = true;
        }
      }
      if (!listed) {
        county_state_list[county_state_list.length] = d.county + " " + d.state;
      }
      listed = false;
  });
  downloaded_data = data;
  /*for (i = 0; i < downloaded_data.length; i++) {
    for (j = 0; j < county_state_list.length; j++) {
      if (county_state_list[j] == downloaded_data[i].county + " " + downloaded_data[i].state) {
            listed = true;
       }
    }
    if (!listed) {
        county_state_list[county_state_list.length] = downloaded_data[i].county + " " + downloaded_data[i].state;
    }
    listed = false;
  }
console.log(county_state_list); */
  for (k = 0; k < county_state_list.length; k++) {
    aggregate_list[k] = {county: county_state_list[k], accumulation: 0};
  } 
  console.log(aggregate_list);

  d3.select("input[value=\"by_state\"]").on("click", by_state);
}); 

d3.json("data/us.json", function(error, us) {
  svg.insert("path", ".graticule")
      .attr("class", "land")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "county-boundary")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "state-boundary")
      .attr("d", path);
});

d3.select(self.frameElement).style("height", height + "px");

function by_year(year) {
  var str_year = year.toString();
  var list = [];
  var county_state_list = [];
  var listcount = 0;
  console.log(year);
  for (i = 0; i < downloaded_data.length; i++) {
    if (downloaded_data[i].year == str_year) {
      list[listcount] = downloaded_data[i];
      listcount = listcount + 1;
    }
  }
  for (i = 0; i < list.length; i++) {
    for (j = 0; j < aggregate_list.length; j++) {
      if (aggregate_list[j].county == list[i].county + " " + list[i].state) {
        if (parseInt(list[i].day1) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day1);
        }
        if (parseInt(list[i].day2) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day2);
        }
        if (parseInt(list[i].day3) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day3);
        }
        if (parseInt(list[i].day4) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day4);
        }
        if (parseInt(list[i].day5) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day5);
        }
        if (parseInt(list[i].day6) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day6);
        }
        if (parseInt(list[i].day7) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day7);
        }
        if (parseInt(list[i].day8) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day8);
        }
        if (parseInt(list[i].day9) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day9);
        }
        if (parseInt(list[i].day10) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day10);
        }
        if (parseInt(list[i].day11) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day11);
        }
        if (parseInt(list[i].day12) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day12);
        }
        if (parseInt(list[i].day13) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day13);
        }
        if (parseInt(list[i].day14) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day14);
        }
        if (parseInt(list[i].day15) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day15);
        }
        if (parseInt(list[i].day16) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day16);
        }
        if (parseInt(list[i].day17) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day17);
        }
        if (parseInt(list[i].day18) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day18);
        }
        if (parseInt(list[i].day19) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day19);
        }
        if (parseInt(list[i].day20) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day20);
        }
        if (parseInt(list[i].day21) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day21);
        }
        if (parseInt(list[i].day22) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day22);
        }
        if (parseInt(list[i].day23) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day23);
        }
        if (parseInt(list[i].day24) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day24);
        }
        if (parseInt(list[i].day25) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day25);
        }
        if (parseInt(list[i].day26) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day26);
        }
        if (parseInt(list[i].day27) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day27);
        }
        if (parseInt(list[i].day28) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day28);
        }
        if (parseInt(list[i].day29) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day29);
        }
        if (parseInt(list[i].day30) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day30);
        }
        if (parseInt(list[i].day31) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day31);
        }
      }
    }
  }
  console.log(aggregate_list);
}

function by_state(state, county, year) {
  console.log(state);
  console.log(county);
  console.log(year);
  var states = [];
  var aggregate = 0;
  count = 0;
  for (i = 0; i < downloaded_data.length; i++) {
    if (downloaded_data[i].state === state) {
       states[i] = downloaded_data[i];
       count = count + 1;
    } 
  }
}
  
</script>
</body>
</html>