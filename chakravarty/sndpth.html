<title>World Snow Depth</title>
<style>

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: .5px;
  stroke-opacity: .5;
}

.land {
  fill: #222;
}

.county-boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

.state-boundary {
  fill: none;
  stroke: #fff;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
  <form>
    <label><input type="radio" name="layout" value="by_state"> Snowfall by State </label> 
    <label><input type="radio" name="layout" value="by_state"> SnowDepth by State </label>
  </form>
<script>

var days = ["day1", "day2", "day3", "day4", "day5", "day6", "day7", "day8", "day9", "day10", "day11", "day12", "day13", "day14", "day15", "day16", "day17", "day18", "day19", "day20", "day21", "day22", "day23", "day24", "day25", "day26", "day27", "day28", "day29", "day30", "day31"]

var downloaded_data;

var states = [];

var width = 960,
    height = 500;

var projection = d3.geo.albers()
    .rotate([96, 0])
    .center([-.6, 38.7])
    .parallels([29.5, 45.5])
    .scale(1070)
    .translate([width / 2, height / 2])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);

var graticule = d3.geo.graticule()
    .extent([[-98 - 45, 38 - 45], [-98 + 45, 38 + 45]])
    .step([5, 5]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

d3.tsv("data/sndpth.tsv", function(error, data) {
  downloaded_data = data;
  d3.select("input[value=\"by_state\"]").on("click", by_state);
}); 

d3.json("data/us.json", function(error, us) {
  svg.insert("path", ".graticule")
      .attr("class", "land")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "county-boundary")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "state-boundary")
      .attr("d", path);
});

d3.select(self.frameElement).style("height", height + "px");

function by_state(state, county, month) {
  console.log(state);
  console.log(county);
  var aggregate = 0;
  count = 0;
  for (i = 0; i < 10000; i++) {
    if (downloaded_data[i].state === state && downloaded_data[i].county === county && downloaded_data[i].month === month) {
       states[i] = downloaded_data[i];
       count = count + 1;
    }
  }
  console.log(count);
}

</script>
</body>
</html>