<title>World Snow Depth</title>
<head>
  <link rel="stylesheet" href="d3.slider.css" /> 
  <style>

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: .5px;
  stroke-opacity: .5;
}

.land {
  fill: #222;
}

.county-boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

.state-boundary {
  fill: none;
  stroke: #fff;
}

.legend rect {
  fill:white;
  stroke:black;
  opacity:0.8;}

.input-color {
    position: relative;
}
.input-color input {
    padding-left: 40px;
}
.input-color .color-box {
    width: 10px;
    height: 10px;
    display: inline-block;
    background-color: #ccc;
    position: absolute;
    left: 5px;
    top: 5px;
}

.wrapper {
      width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

.wrapper > div {
      margin: 35px 0;
    }

</style>
</head>
<body>
<div class="wrapper">
  <div id="slider1"></div>
</div>
Time: 2005 <input type="range" name="points" min="2005" max="2015" step="1" value="0" id="slider-time" oninput="year_value();"> 2015

<table style="width:20%">
  <tr>
    <td><div class="input-color">
      <input type="text" value="Negligible" />
    <div class="color-box" style="background-color: #0000FF;"></div>
    <!-- Replace "#FF850A" to change the color -->
</div></td>
  </tr>
  <tr>
    <td><div class="input-color">
    <input type="text" value="<1" />
    <div class="color-box" style="background-color: #013ADF;"></div>
    <!-- Replace "#FF850A" to change the color -->
</div></td>
  </tr>
  <tr>
    <td><div class="input-color">
    <input type="text" value="<10" />
    <div class="color-box" style="background-color: #0431B4;"></div>
    <!-- Replace "#FF850A" to change the color -->
</div></td>
  </tr>
  <tr>
    <td><div class="input-color">
    <input type="text" value="<50" />
    <div class="color-box" style="background-color: #5858FA;"></div>
    <!-- Replace "#FF850A" to change the color -->
</div></td>
  </tr>
  <tr>
    <td><div class="input-color">
    <input type="text" value="100+" />
    <div class="color-box" style="background-color: #0B0B61;"></div>
    <!-- Replace "#FF850A" to change the color -->
</div></td>
  </tr>
</table>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="d3.slider.js"></script>
<script>
    d3.select('#slider1').call(d3.slider());
</script>
  <form>
    <label><input type="radio" name="layout" value="by_state"> Snowfall by State </label> 
    <label><input type="radio" name="layout" value="by_state"> SnowDepth by State </label>
  </form>
<script>

var color = d3.scale.category10();

var downloaded_data;

var states = [];

var county_state_list = [];
var aggregate_list = [];
var listed = false;

var width = 960,
    height = 500;

var projection = d3.geo.albers()
    .rotate([96, 0])
    .center([-.6, 38.7])
    .parallels([29.5, 45.5])
    .scale(1070)
    .translate([width / 2, height / 2])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);

var graticule = d3.geo.graticule()
    .extent([[-98 - 45, 38 - 45], [-98 + 45, 38 + 45]])
    .step([5, 5]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height); 

function year_value(data) {
    d3.selectAll("input").each(function(d) {
        if(d3.select(this).attr("type") == "range") {
            year = (this).value;
        }
    })
    by_year(year);
};

svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

d3.tsv("data/sndpth.tsv", function(error, data) {
  color.domain(d3.keys(data[0]).filter(function(key) { return key == "elevation"; }));
  console.log(data);
  data.forEach(function(d) {
      for (j = 0; j < county_state_list.length; j++) {
        if (county_state_list[j] == d.county + " " + d.state) {
          listed = true;
        }
      }
      if (!listed) {
        county_state_list[county_state_list.length] = d.county + " " + d.state;
      }
      listed = false;
  });

    downloaded_data = data;
  for (k = 0; k < county_state_list.length; k++) {
    aggregate_list[k] = {county: county_state_list[k], accumulation: 0};
  } 
  d3.select("input[value=\"by_state\"]").on("click", by_state);

}); 

d3.json("data/us.json", function(error, us) {
  svg.insert("path", ".graticule")
      .attr("class", "land")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "county-boundary")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .attr("class", "state-boundary")
      .attr("d", path);
});

d3.select(self.frameElement).style("height", height + "px");

function by_year(year) {
  var str_year = year.toString();
  var list = [];
  var county_state_list = [];
  var listcount = 0;
  console.log(year);
  for (i = 0; i < downloaded_data.length; i++) {
    if (downloaded_data[i].year == str_year) {
      list[listcount] = downloaded_data[i];
      listcount = listcount + 1;
    }
  }
  for (i = 0; i < list.length; i++) {
    for (j = 0; j < aggregate_list.length; j++) {
      if (aggregate_list[j].county == list[i].county + " " + list[i].state) {
        if (parseInt(list[i].day1) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day1);
        }
        if (parseInt(list[i].day2) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day2);
        }
        if (parseInt(list[i].day3) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day3);
        }
        if (parseInt(list[i].day4) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day4);
        }
        if (parseInt(list[i].day5) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day5);
        }
        if (parseInt(list[i].day6) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day6);
        }
        if (parseInt(list[i].day7) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day7);
        }
        if (parseInt(list[i].day8) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day8);
        }
        if (parseInt(list[i].day9) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day9);
        }
        if (parseInt(list[i].day10) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day10);
        }
        if (parseInt(list[i].day11) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day11);
        }
        if (parseInt(list[i].day12) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day12);
        }
        if (parseInt(list[i].day13) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day13);
        }
        if (parseInt(list[i].day14) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day14);
        }
        if (parseInt(list[i].day15) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day15);
        }
        if (parseInt(list[i].day16) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day16);
        }
        if (parseInt(list[i].day17) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day17);
        }
        if (parseInt(list[i].day18) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day18);
        }
        if (parseInt(list[i].day19) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day19);
        }
        if (parseInt(list[i].day20) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day20);
        }
        if (parseInt(list[i].day21) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day21);
        }
        if (parseInt(list[i].day22) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day22);
        }
        if (parseInt(list[i].day23) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day23);
        }
        if (parseInt(list[i].day24) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day24);
        }
        if (parseInt(list[i].day25) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day25);
        }
        if (parseInt(list[i].day26) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day26);
        }
        if (parseInt(list[i].day27) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day27);
        }
        if (parseInt(list[i].day28) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day28);
        }
        if (parseInt(list[i].day29) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day29);
        }
        if (parseInt(list[i].day30) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day30);
        }
        if (parseInt(list[i].day31) > 0) {
          aggregate_list[j].accumulation = aggregate_list[j].accumulation + parseInt(list[i].day31);
        }
      }
    }
  }
  console.log(aggregate_list);
}

function by_state(state, county, year) {
  console.log(state);
  console.log(county);
  console.log(year);
  var states = [];
  var aggregate = 0;
  count = 0;
  for (i = 0; i < downloaded_data.length; i++) {
    if (downloaded_data[i].state === state) {
       states[i] = downloaded_data[i];
       count = count + 1;
    } 
  }
}

</script>
</body>
</html>